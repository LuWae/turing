#include <stdio.h>
#include <string.h>

#include "../src/tape.h"

#define ASSERT(c, msg) if (!(c)) {printf("Test failed: %s\n", msg); return -1;}
#define ASSERT_JMP(c, msg, jmp) if (!(c)) {printf("Test failed: %s\n", msg); goto jmp;}

uint8_t sym2num[] = {
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    1   ,2   ,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0   ,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
};
char *num2sym = "_01";

int tape_test1() {
    struct tape *t = tape_create_empty();
    char buf[32];

    ASSERT(t != NULL, "allocation error")
    ASSERT_JMP(t->l.size == 0 && t->r.size == 0, "tape not initialized correctly", FAIL1)

    tape_write_string(t, "0100101_01___1", sym2num);
    tape_write(t, 0, 13);
    tape_write(t, 2, -5);

    tape_sprint(t, buf, num2sym);
    ASSERT_JMP(strcmp(buf, "1____0100101_01") == 0, "unexpected tape content", FAIL1)

    tape_destroy(t);
    return 0;
FAIL1:
    tape_destroy(t);
    return -1;
}

int main() {
    if (tape_test1())
        printf("Tests failed.\n");
    else
        printf("Tests successful.\n");

    return 0;
}
